(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{63:(e,t,r)=>{"use strict";var s=r(7260);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},1290:()=>{},3803:(e,t,r)=>{"use strict";r.d(t,{default:()=>c});var s=r(5155),a=r(2115),o=r(63),n=r(8209),i=r(5299);function c(e){let{children:t}=e,r=(0,o.useRouter)(),c=(0,o.usePathname)(),[l,u]=(0,a.useState)(null),h=["/","/login","/signin","/register","/signup"].includes(c);return((0,a.useEffect)(()=>{(async()=>{let e=n.y.isAuthenticated();if(!e&&!h){sessionStorage.setItem("redirectAfterLogin",c),r.replace("/login?redirect=".concat(encodeURIComponent(c)));return}if(e&&("/login"===c||"/signin"===c||"/register"===c||"/signup"===c))return r.replace("/dashboard");u(e)})()},[c,r,h]),null===l)?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(i.A,{className:"h-12 w-12 animate-spin text-indigo-600 mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}):l||h?(0,s.jsx)(s.Fragment,{children:t}):null}},5299:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(1847).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},7621:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var s=r(5125);let a="https://slackcrm-backend.fly.dev/api/v1",o=s.A.create({baseURL:a,headers:{"Content-Type":"application/json"}}),n=!1,i=[],c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i.forEach(r=>{e?r.reject(e):r.resolve(t)}),i=[]};o.interceptors.request.use(e=>{{let t=localStorage.getItem("accessToken");t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t))}return e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!r._retry){if(n)return new Promise((e,t)=>{i.push({resolve:e,reject:t})}).then(e=>(r.headers&&(r.headers.Authorization="Bearer ".concat(e)),o(r))).catch(e=>Promise.reject(e));r._retry=!0,n=!0;{let t=localStorage.getItem("refreshToken");if(!t)return localStorage.clear(),window.location.href="/login",Promise.reject(e);try{let{accessToken:e,refreshToken:i}=(await s.A.post("".concat(a,"/auth/refresh"),{refreshToken:t})).data;return localStorage.setItem("accessToken",e),localStorage.setItem("refreshToken",i),r.headers&&(r.headers.Authorization="Bearer ".concat(e)),c(null,e),n=!1,o(r)}catch(e){return c(e,null),n=!1,localStorage.clear(),window.location.href="/login",Promise.reject(e)}}}return Promise.reject(e)});let l=o},8209:(e,t,r)=>{"use strict";r.d(t,{y:()=>o});var s=r(7621);class a{async login(e){let t=await s.A.post("/auth/login",e);return this.setSession(t.data),t.data}async register(e){let t=await s.A.post("/auth/register",e);return this.setSession(t.data),t.data}async logout(){try{await s.A.post("/auth/logout")}catch(e){console.error("Logout error:",e)}finally{this.clearSession()}}async refreshToken(){let e=this.getRefreshToken();if(!e)throw Error("No refresh token available");let t=await s.A.post("/auth/refresh",{refreshToken:e});return this.setTokens(t.data.accessToken,t.data.refreshToken),t.data.accessToken}async getProfile(){let e=await s.A.get("/auth/profile");return this.setUser(e.data),e.data}async getCurrentUser(){let e=await s.A.get("/auth/me");return this.setUser(e.data),e.data}setSession(e){localStorage.setItem(this.TOKEN_KEY,e.accessToken),localStorage.setItem(this.REFRESH_TOKEN_KEY,e.refreshToken),localStorage.setItem(this.USER_KEY,JSON.stringify(e.user))}setTokens(e,t){localStorage.setItem(this.TOKEN_KEY,e),localStorage.setItem(this.REFRESH_TOKEN_KEY,t)}setUser(e){localStorage.setItem(this.USER_KEY,JSON.stringify(e))}clearSession(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY)}getToken(){return localStorage.getItem(this.TOKEN_KEY)}getRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)}getUser(){{let e=localStorage.getItem(this.USER_KEY);if(e)try{return JSON.parse(e)}catch(e){}}return null}isAuthenticated(){return!!this.getToken()}constructor(){this.TOKEN_KEY="accessToken",this.REFRESH_TOKEN_KEY="refreshToken",this.USER_KEY="user"}}let o=new a},9298:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,1290,23)),Promise.resolve().then(r.bind(r,3803))}},e=>{e.O(0,[741,211,441,255,358],()=>e(e.s=9298)),_N_E=e.O()}]);